<!DOCTYPE html>
<html lang="zh-CN"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http://mylofi.fun/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://mylofi.fun/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://mylofi.fun/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://mylofi.fun/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://mylofi.fun/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    è®° Git ç›®å½•ä½“ç§¯è¿‡å¤§çš„ä¼˜åŒ–æ–¹æ¡ˆ | 
    
</title>

<link rel="canonical" href="http://mylofi.fun/posts/git-slim/"/>

<meta property="og:url" content="http://mylofi.fun/posts/git-slim/">
  <meta property="og:title" content="è®° Git ç›®å½•ä½“ç§¯è¿‡å¤§çš„ä¼˜åŒ–æ–¹æ¡ˆ">
  <meta property="og:description" content="ä¸€æ¬¡ä¼˜åŒ– Git å†å²æäº¤ä¸­åŒ…å«å¯¹å¤§æ–‡ä»¶å¼•ç”¨çš„è¿‡ç¨‹">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-12-20T17:03:14+08:00">
    <meta property="article:modified_time" content="2022-12-20T17:03:14+08:00">
    <meta property="article:tag" content="Git">












<link rel="stylesheet" href="/assets/combined.min.403fefeb55ad9a9e72af41abf4538457b584695b1fdcef661626b87d8b07dec9.css" media="all">




      <script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxxxxxxx"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-xxxxxxxxx');
        }
      </script>











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/git-slim/">è®° Git ç›®å½•ä½“ç§¯è¿‡å¤§çš„ä¼˜åŒ–æ–¹æ¡ˆ</a></div>


<div  class="autonumber" >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">è®° Git ç›®å½•ä½“ç§¯è¿‡å¤§çš„ä¼˜åŒ–æ–¹æ¡ˆ</h1>
        <p class="single-summary">ä¸€æ¬¡ä¼˜åŒ– Git å†å²æäº¤ä¸­åŒ…å«å¯¹å¤§æ–‡ä»¶å¼•ç”¨çš„è¿‡ç¨‹</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="single-date">
              <time datetime="2022-12-20T17:03:14&#43;08:00">2022-12-20</time>
              &nbsp; Â· &nbsp;1 min read
            </p>
          </div>
        </div>
        
    </header>
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#è¸©å‘æ–¹æ¡ˆä¸€">è¸©å‘æ–¹æ¡ˆä¸€</a>
      <ul>
        <li><a href="#è¯†åˆ«æŸ¥è¯¢å¤§æ–‡ä»¶">è¯†åˆ«æŸ¥è¯¢å¤§æ–‡ä»¶</a></li>
        <li><a href="#åˆ é™¤æ–‡ä»¶">åˆ é™¤æ–‡ä»¶</a></li>
        <li><a href="#æ¨é€åˆ°è¿œç¨‹">æ¨é€åˆ°è¿œç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#ç»ˆææ–¹æ¡ˆäºŒ">ç»ˆææ–¹æ¡ˆäºŒ</a>
      <ul>
        <li><a href="#å®‰è£…-git-filter-pro">å®‰è£… git-filter-pro</a></li>
        <li><a href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </aside>
    
    <div class="single-content">
      <p>Git ç‰ˆæœ¬ä»“åº“æäº¤è¿‡å¤šï¼Œä¼šå¯¼è‡´é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>.git</code> æ–‡ä»¶å¤¹ä½“ç§¯å·¨å¤§ï¼ŒåŸå› å¯èƒ½ä¸åªæ˜¯å•çº¯çš„æäº¤å†å²è¿‡å¤šï¼Œè€Œæ˜¯å†å²æäº¤ä¸­åŒ…å«æœ‰å¯¹å¤§æ–‡ä»¶çš„å¼•ç”¨ï¼Œå³ä½¿ç°åœ¨çš„é¡¹ç›®ä¸­å·²ç»ä¸å­˜åœ¨è¿™äº›æ–‡ä»¶äº†ï¼Œä½†å…¶å¼•ç”¨å…³è”ä¾æ—§ä¼šè¢« <code>git</code> ä¿ç•™ä¸‹æ¥ã€‚</p>
<h2 class="heading" id="è¸©å‘æ–¹æ¡ˆä¸€">
  è¸©å‘æ–¹æ¡ˆä¸€
  <a class="anchor" href="#%e8%b8%a9%e5%9d%91%e6%96%b9%e6%a1%88%e4%b8%80">#</a>
</h2>
<p><code>git filter-branch</code> å‘½ä»¤å¯ä»¥æ”¹å†™å†å²ä¸­å¤§é‡çš„æäº¤ï¼Œä½†æ˜¯å®ƒæœ‰å¾ˆå¤šé™·é˜±ï¼Œè€Œä¸”å®˜æ–¹æ–‡æ¡£ä¸­å·²ç»ä¸æ¨èä½¿ç”¨å®ƒæ¥é‡å†™å†å²äº†ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå‘æ˜¯æˆ‘è¸©è¿‡ä¹‹åæ‰çŸ¥é“çš„ã€‚</p>
<h3 class="heading" id="è¯†åˆ«æŸ¥è¯¢å¤§æ–‡ä»¶">
  è¯†åˆ«æŸ¥è¯¢å¤§æ–‡ä»¶
  <a class="anchor" href="#%e8%af%86%e5%88%ab%e6%9f%a5%e8%af%a2%e5%a4%a7%e6%96%87%e4%bb%b6">#</a>
</h3>
<p>æ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>.idx</code> æ–‡ä»¶ï¼Œè·¯å¾„ï¼š</p>
<blockquote>
<p><code>.git/objects/pack/pack-************.idx</code></p></blockquote>
<p>æ‰§è¡Œï¼š</p>
<blockquote>
<p><code>git rev-list --objects --all | grep -f &lt;(git verify-pack -v  .git/objects/pack/******.idx| sort -k 3 -n | cut -f 1 -d &quot; &quot; | tail -10)</code></p></blockquote>
<p>è¿è¡Œç»“æœå¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>c0b33abdf3af4f0a4ae82d6243954eeb344432d9 src/components/Emoji/emoji.png
</span></span><span style="display:flex;"><span>a08b3b0f766d26729cbaf0b7e86212b0ca4a5569 dist/js/2a10361c.async.js
</span></span><span style="display:flex;"><span>1d26f0da81c885c676badb026367a47183013fb5 dist/js/84ad94bf.async.js
</span></span><span style="display:flex;"><span>eb07071cdea7e019953a3a6778a4bb6e728ea13d dist/js/4922a65f.async.js
</span></span><span style="display:flex;"><span>7ddf057a0e26f300137c84cf03dbe088a69da488 dist/js/62f9d99c.async.js
</span></span></code></pre></div><h3 class="heading" id="åˆ é™¤æ–‡ä»¶">
  åˆ é™¤æ–‡ä»¶
  <a class="anchor" href="#%e5%88%a0%e9%99%a4%e6%96%87%e4%bb%b6">#</a>
</h3>
<p>å°†è¯¥æ–‡ä»¶ä»å†å²è®°å½•çš„æ‰€æœ‰ tree ä¸­ç§»é™¤ï¼Œæ‰§è¡Œï¼š</p>
<blockquote>
<p><code>gitÂ filter-branchÂ --index-filterÂ 'gitÂ rmÂ --cachedÂ --ignore-unmatchÂ Â src/components/Emoji/emoji.png'</code></p></blockquote>
<p>æ³¨ï¼šéœ€è¦ä¾æ¬¡æ‰§è¡Œè¯¥å‘½ä»¤å»åˆ é™¤è¿™äº›å¤§æ–‡ä»¶ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤š <code>jpg/js.map/gif</code> ç­‰ç±»å‹çš„æ–‡ä»¶ã€‚</p>
<h3 class="heading" id="æ¨é€åˆ°è¿œç¨‹">
  æ¨é€åˆ°è¿œç¨‹
  <a class="anchor" href="#%e6%8e%a8%e9%80%81%e5%88%b0%e8%bf%9c%e7%a8%8b">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>rmÂ -rfÂ .git/refs/original/
</span></span><span style="display:flex;"><span>gitÂ reflogÂ expireÂ --expire=nowÂ --all
</span></span><span style="display:flex;"><span>gitÂ fsckÂ --fullÂ --unreachable 
</span></span><span style="display:flex;"><span>gitÂ repackÂ -AÂ -d
</span></span><span style="display:flex;"><span>gitÂ gcÂ --aggressiveÂ --prune=now
</span></span><span style="display:flex;"><span>gitÂ pushÂ --force
</span></span></code></pre></div><p>ä¾æ¬¡æ‰§è¡Œå®Œä»¥ä¸Šå‘½ä»¤åï¼Œæ­¤æ—¶å»æ£€æŸ¥è¿œç¨‹ä»“åº“ï¼Œç»“æœä»¤äººè¯§å¼‚ï¼Œå±…ç„¶&hellip;æ²¡æœ‰&hellip;ç”Ÿæ•ˆ&hellip;æœ¬åœ°ç¡®å®æ˜¯æ¸…ç†æ‰äº†ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œä» <code>1.2G</code> ç˜¦èº«åˆ° <code>600M</code> å·¦å³ï¼Œä½†æ˜¯æ¨é€åå¹¶æ²¡æœ‰ä½œç”¨ï¼Œäºæ˜¯ç»§ç»­å¯»æ‰¾å…¶ä»–æ–¹æ¡ˆï¼Œç»“æœçœ‹åˆ° <a href="https://stackoverflow.com/questions/2100907/how-to-remove-delete-a-large-file-from-commit-history-in-the-git-repository?answertab=modifieddesc&amp;newreg=adaec4ffc87445179ca5946bf95f0109#tab-top">stackoverflow</a> ä¸Šæœ‰ä¸€ä¸ªä¸€æ‘¸ä¸€æ ·çš„é—®é¢˜ï¼ŒæŒ‰ <code>Date modified (newest first)</code> æ’åºä¹‹åï¼Œçœ‹åˆ°ğŸ‘‡












<figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="" src="/images/git-slim/1.png" >
    </div>

    
    <div class="caption-container">
        <figcaption>  </figcaption>
    </div>
    
</figure>

ä¹Ÿå°±æ˜¯è¯´ 2022 äº†ï¼Œ<code>git filter-branch</code> å·²ç»ä¸å¥½ä½¿äº†ï¼Œæ¨é€åˆ°è¿œç¨‹ä¹‹åæ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œæ–¹æ¡ˆä¸€ä»¥å¤±è´¥å‘ŠçŠ¶ã€‚</p>
<h2 class="heading" id="ç»ˆææ–¹æ¡ˆäºŒ">
  ç»ˆææ–¹æ¡ˆäºŒ
  <a class="anchor" href="#%e7%bb%88%e6%9e%81%e6%96%b9%e6%a1%88%e4%ba%8c">#</a>
</h2>
<p><code>git</code> å®˜æ–¹æ–‡æ¡£æ¨èäº†è¿™ä¸ªåº“ï¼š <a href="https://github.com/newren/git-filter-repo">git-filter-pro</a> ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥é‡å†™ git å†å²çš„å¤šåŠŸèƒ½ <code>Python</code> è„šæœ¬ï¼Œå³ä½¿ç°åœ¨åœ¨é¡¹ç›®å½“ä¸­æ‰¾ä¸åˆ°é‚£äº›å†å²æ–‡ä»¶ï¼Œå®ƒä¾ç„¶å¯ä»¥æ‰¾åˆ°å®ƒä»¬å¹¶è¿›è¡Œæ¸…ç†ï¼ˆçœ‹æ¥è¿™æ‰æ˜¯æˆ‘æƒ³è¦çš„ä¸œè¥¿ï¼‰ã€‚</p>
<h3 class="heading" id="å®‰è£…-git-filter-pro">
  å®‰è£… git-filter-pro
  <a class="anchor" href="#%e5%ae%89%e8%a3%85-git-filter-pro">#</a>
</h3>
<blockquote>
<p><code>brew install git-filter-repo</code></p></blockquote>
<p>âŒ æŠ¥é”™</p>
<blockquote>
<p><code>No such file or directory @ rb_sysopen -xxxxx</code></p></blockquote>
<p>âœ… è§£å†³æ–¹æ¡ˆ</p>
<blockquote>
<p>åŸå› æ˜¯ä½¿ç”¨å›½å†…é•œåƒä½†æ˜¯è¯¥é•œåƒæœªå®Œå…¨åŒæ­¥çš„é—®é¢˜ï¼Œä¸´æ—¶å»é™¤é•œåƒå³å¯ï¼š
<code>export HOMEBREW_BOTTLE_DOMAIN=''</code></p></blockquote>
<h3 class="heading" id="å¦‚ä½•ä½¿ç”¨">
  å¦‚ä½•ä½¿ç”¨
  <a class="anchor" href="#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8">#</a>
</h3>
<p>è¿™é‡Œå¯ä»¥æ­é…æ­¤å‘½ä»¤æ¥æ‰¾åˆ°é‚£äº›å†å²ä¸­çš„å¤§æ–‡ä»¶ï¼Œç„¶åé€ä¸€æ¸…ç†ã€‚</p>
<blockquote>
<p><code>git rev-list --objects --all | grep -f &lt;(git verify-pack -v  .git/objects/pack/******.idx| sort -k 3 -n | cut -f 1 -d &quot; &quot; | tail -10)</code></p></blockquote>
<p>å‡è®¾è¦æ¸…ç†å…¨éƒ¨çš„ <code>*.jpg</code> æ–‡ä»¶ï¼Œåªéœ€è¦å¦‚ä¸‹å‘½ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™æ ·ä¹Ÿä¼šæŠŠé¡¹ç›®ä¸­ç°æœ‰çš„æ‰€æœ‰ <code>.jpg</code> æ–‡ä»¶æ¸…ç†æ‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>git filter-repo --path-glob &#39;*.jpg&#39; --invert-paths
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ä¹‹åï¼Œå¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ğŸ‘‡
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git push --all --force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>git push --tags --force
</span></span></code></pre></div><p>åºŸäº†ä¸€äº›åŠŸå¤«ï¼Œæ•ˆæœä¸€çº§æ£’ğŸ‘












<figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="" src="/images/git-slim/2.png" >
    </div>

    
    <div class="caption-container">
        <figcaption> æ¸…ç†å‰ </figcaption>
    </div>
    
</figure>













<figure class="">

    <div class="img-container" >
        <img loading="lazy" alt="" src="/images/git-slim/3.png" >
    </div>

    
    <div class="caption-container">
        <figcaption> æ¸…ç†å </figcaption>
    </div>
    
</figure>
</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E5%86%99%E5%8E%86%E5%8F%B2">Git-å·¥å…·-é‡å†™å†å²</a></li>
<li><a href="https://github.com/newren/git-filter-repo/blob/main/INSTALL.md">git-filter-repo</a></li>
</ul>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">â†</div>
                <div class="single-pagination-text">
                    <a href="/posts/interview/">
                        é¢ç»è®°å½•
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/nginx-conf/">
                        ä½¿ç”¨ Nginx éƒ¨ç½²ä¸€ä¸ªé™æ€é¡µé¢
                    </a>
                </div>
                <div class="single-pagination-text">â†’</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
